// This is a copy of schema.prisma ADAPTED for PostgreSQL (External DB)
// Generated by SuporTicket Helper

datasource db {
  provider = "postgresql" // Changed to postgresql
  url      = env("EXTERNAL_DB_URL") // Uses strictly the external URL
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client-postgres" // Generates a separate client
}

// --- MODELS (Identical to schema.prisma) ---

model Brand {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  tickets Ticket[]
}

model Category {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  slug    String   @unique
  prefix  String   @default("GEN")
  tickets Ticket[]
}

model Ticket {
  id                 String   @id @default(cuid())
  ticketNumber       Int      @default(0)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  status             String   @default("PENDING")
  priority           String   @default("MEDIUM")
  cancellationReason String?

  customerId    String?
  customer      Customer? @relation(fields: [customerId], references: [id])
  customerName  String
  customerPhone String
  contactMethod String?

  addressStreet String @default("")
  addressColony String @default("")
  addressZip    String @default("")
  addressCity   String @default("")
  propertyType  String @default("RESIDENTIAL")

  brandId      Int
  brand        Brand    @relation(fields: [brandId], references: [id])
  categoryId   Int
  category     Category @relation(fields: [categoryId], references: [id])
  model        String?
  serialNumber String?

  issueDescription String
  triageData       String // JSON - Prisma Postgres might prefer Json type but String is compatible

  technicianId String?
  technician   User?   @relation(fields: [technicianId], references: [id])

  photos Photo[]

  laborCost Float @default(0)
  partsCost Float @default(0)
  totalCost Float @default(0)

  invoiceUrl   String?
  signatureUrl String?

  technicianNotes String?
  isRepaired      Boolean @default(false)

  invoiceName    String?
  invoiceTaxId   String?
  invoiceEmail   String?
  invoiceAddress String?

  includeIva           Boolean @default(true)
  appliedIvaPercentage Float   @default(21.0)
}

model Customer {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String
  phone     String   @unique
  email     String?
  address   String?
  documentNumber String?  @unique
  tickets   Ticket[]
}

model User {
  id       String   @id @default(cuid())
  email    String   @unique
  name     String?
  password String?
  phone    String?
  role     String   @default("TECHNICIAN")
  tickets  Ticket[]
}

model Photo {
  id       String @id @default(cuid())
  url      String
  type     String
  ticketId String
  ticket   Ticket @relation(fields: [ticketId], references: [id])
}

model SparePart {
  id    Int    @id @default(autoincrement())
  name  String
  sku   String @unique
  price Float
  stock Int    @default(0)
}

// CompanySettings is technically local-only but including it here doesn't hurt, 
// allows for cloud backup if desired later.
model CompanySettings {
  id             Int      @id @default(1)
  name           String   @default("My Company")
  taxId          String   @default("")
  address        String   @default("")
  phone          String   @default("")
  email          String   @default("")
  logoUrl        String?  @default("")
  ivaPercentage  Float    @default(21.0)
  currencySymbol String   @default("EUR")
  currencyCode   String   @default("EUR")
  countryCode    String   @default("34")
  
  cloudinaryCloudName String @default("")
  cloudinaryApiKey    String @default("")
  cloudinaryApiSecret String @default("")

  externalDbUrl       String @default("")

  updatedAt      DateTime @updatedAt
}
